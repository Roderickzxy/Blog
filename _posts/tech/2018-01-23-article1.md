---
layout: post
title:  "搭建docker环境"
crawlertitle: "搭建docker环境"
summary: "在ubuntu上搭建docker"
date:   2018-01-23 13:24:56 +0700
cataname: 积累，等待，蜕变
category: tech/2018-01-23
tags: 'tech-Docker'
author: Roderick
---
这里安装的docker版本是docker ce，社区版，不收费可做开发使用，准备好虚拟机，这里使用ubuntu16.04.
官方要求系统：
[![attache1]({{ site.article_attachedimages | relative_url }}/tech/article4-attache1.jpg)]({{ site.article_attachedimages | relative_url }}/article4-attache1.jpg)  

## 1.卸载旧版docker： （老版本可能是docker也可能是docker-engine）##
{% highlight shell %}
$ sudo apt-get remove docker docker-engine docker.io
{% endhighlight %}   
## 2.搭建repository ##

### 2.1 更新apt包： ###
{% highlight shell %}
$ sudo apt-get update  
{% endhighlight %}   
### 2.2 安装相关包使apt可以使用https： ###
{% highlight shell %}
$ sudo apt-get install \  
    apt-transport-https \  
    ca-certificates \  
    curl \  
    software-properties-common  
{% endhighlight %}  
### 2.3 添加docker官方的GPG key ###
{% highlight shell %}
$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -  
{% endhighlight %}  
校验一下是不是已经有那个key了  
{% highlight shell %}
$ sudo apt-key fingerprint 0EBFCD88  
pub   4096R/0EBFCD88 2017-02-22
      Key fingerprint = 9DC8 5822 9FC7 DD38 854A  E2D8 8D81 803C 0EBF CD88  
uid                  Docker Release (CE deb) <docker@docker.com>  
sub   4096R/F273FCD8 2017-02-22
{% endhighlight %}
### 2.4 添加docker源 ###
我的cpu支持am64指令集，所以直接使用如下命令：（edge test 都是源）  
{% highlight shell %}
$ sudo add-apt-repository \  
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \  
   $(lsb_release -cs) \  
   stable edge test"  
{% endhighlight %}

## 3 安装docker ce ##
### 3.1 更新apt包： ###
{% highlight shell %}
$ sudo apt-get update  
{% endhighlight %} 
### 3.2 安装最新版本的docker ###
{% highlight shell %}
$ sudo apt-get install docker-ce  
{% endhighlight %} 
另外有指定版本下载docker的方式，这里就不讲述了。
如果上述安装步骤不能成功执行，可以使用一个叫convenience script的方式去安装。  
[![attache1]({{ site.article_attachedimages | relative_url }}/tech/article4-attache2.jpg)]({{ site.article_attachedimages | relative_url }}/article4-attache2.jpg)    

docker的一些构建镜像的相关命令
{% highlight shell %}
docker build -t friendlyhello .  # Create image using this directory's Dockerfile  
docker run -p 4000:80 friendlyhello  # Run "friendlyname" mapping port 4000 to 80  
docker run -d -p 4000:80 friendlyhello         # Same thing, but in detached mode  
docker container ls                                # List all running containers  
docker container ls -a             # List all containers, even those not running   
docker container stop <hash>           # Gracefully stop the specified container   
docker container kill <hash>         # Force shutdown of the specified container   
docker container rm <hash>        # Remove specified container from this machine   
docker container rm $(docker container ls -a -q)         # Remove all containers  
docker image ls -a                             # List all images on this machine  
docker image rm <image id>            # Remove specified image from this machine  
docker image rm $(docker image ls -a -q)   # Remove all images from this machine  
docker login             # Log in this CLI session using your Docker credentials  
docker tag <image> username/repository:tag  # Tag <image> for upload to registry   
docker push username/repository:tag            # Upload tagged image to registry  
docker run username/repository:tag                   # Run image from a registry  
{% endhighlight %} 